---
const { title, id, summary, resources, apuntes_content, class_content, isMain = false } = Astro.props;
---

<div 
  class={`roadmap-box ${isMain ? 'main-box' : ''}`} 
  data-id={id} 
  data-title={title}
  data-summary={summary} 
  data-resources={JSON.stringify(resources)}
  data-apuntes={apuntes_content}
  data-class={class_content}
>
<p>{title}</p>
</div>

<style>
  .roadmap-box {
    padding: 1rem;
    border: 2px solid #ccc;
    border-radius: 12px;
    text-align: center;
    font-weight: normal;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.3s;
  }
  .roadmap-box:hover {
    background-color: #f0f0f0;
    transform: translateY(-5px);
    font-weight: bold;
  }
  .main-box {
    background-color: #ffd700;
    font-weight: bold;
  }

  p {
    margin: 0;
  }
</style>

<script>
  document.querySelectorAll('.roadmap-box').forEach(box => {
    box.addEventListener('click', () => {
      const id = box.getAttribute('data-id');
      const title = box.getAttribute('data-title');
      const summary = box.getAttribute('data-summary');
      const apuntes = box.getAttribute('data-apuntes');
      const clase = box.getAttribute('data-class');
      let resources = [];
      try {
        resources = JSON.parse(box.getAttribute('data-resources') || '[]');
      } catch (e) {
        console.error('Error parsing resources:', e);
      }
      
      if (id && title && summary) {
        openModal(id, title, summary, apuntes, clase, resources);
      } else {
        console.warn('Missing data for modal:', { id, title, summary });
      }
    });
  });

  function openModal(id, title, summary, apuntes, clase, resources) {
    const modal = document.getElementById('modal');
    if (modal) {
      const modalTitle = modal.querySelector('#modal-title');
      const modalSummary = modal.querySelector('#modal-summary');
      const modalApuntes = modal.querySelector('#modal-apuntes');
      const modalClase = modal.querySelector('#modal-clase');
      const resourcesList = modal.querySelector('#modal-resources');

      if (modalTitle) modalTitle.textContent = title;
      if (modalSummary) modalSummary.textContent = summary;
      if (modalApuntes) modalApuntes.textContent = apuntes ? `Apuntes: ${apuntes}` : 'Apuntes: En proceso';
      if (modalClase) modalClase.textContent = clase ? `Clase: ${clase}` : 'Clase: En proceso';

      if (resourcesList) {
        resourcesList.innerHTML = '';
        resources.forEach(resource => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = resource.url;
          a.textContent = resource.title;
          a.target = '_blank';
          li.appendChild(a);
          resourcesList.appendChild(li);
        });
      }

      modal.style.display = 'block';
    }
  }
</script>